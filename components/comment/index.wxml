<!-- <wxs module="wxs" src="./index.wxs"></wxs> -->
<scroll-view scroll-y="true" bindscrolltolower="loadMore" class="scroll-view">
  <view class="comment-container">
    <view class="total">共 {{comment.length}} 条评论</view>
    <input wx:if="{{!replyId}}" type="text" placeholder="爱评论的人运气都不差~" class="comment-input" bindconfirm="onSubmit" bindinput="handleInput" value="{{inputValue}}" focus="{{inputActive}}" bindblur="handleBlur"/>
    <input wx:else type="text" placeholder="{{replyAuthor}}" class="comment-input" bindconfirm="onSubmit" bindinput="handleInput" value="{{inputValue}}" focus="{{inputActive}}" bindblur="handleBlur"/>
    
      <view wx:for="{{comment}}" wx:key="item" class="comment-box" bindtap="handleReply" data-currComment="{{item}}">
          <image wx:if="{{item.authorAvatarUrl}}" class="user-avatar" src="{{item.authorAvatarUrl}}"></image>
          <image wx:else class="user-avatar" src="{{'/assets/bbb.png'}}"></image>
          <view class="comment-content">
            <view class="name">
              {{item.authorName}}
              <!-- <view wx:if="{{!!item.replyId}}" class="comment-reply">回复 {{wxs.getParentReplay(comment,item.replyId)}}</view> -->
            </view>
            <view class="content">{{item.content}}</view>
            <view wx:if="{{!!item.subReviews && !item.expand}}" class="comment-reply" data-rid="{{item.id}}" data-subpagesize="{{1}}" catchtap="handleSubComment">展开{{item.subReviews}}条回复</view>
            <view wx:for="{{item.children}}" wx:key="item" class="sub-comment-box" catchtap="handleReply" data-currComment="{{item}}">
              <image class="user-avatar" src="{{'/assets/bbb.png'}}"></image>
              <view class="comment-content">
                <view class="name">
                  {{item.authorName}}
                  <view wx:if="{{!!item.replyToAuthorName}}" style="display: inline;margin-left: 5rpx;">回复 {{item.replyToAuthorName}}</view>
                </view>
                <view class="sub-content">{{item.content}}</view>
              </view>
              <view class="like" catchtap="likeComment" data-currComment="{{item}}">
                <image src="/assets/icons/heart-fill.png" wx:if="{{item.likedByCurUser}}"/>
                <image src="/assets/icons/heart.png" wx:else/>
                {{item.like}}
              </view>
            </view>
            <view wx:if="{{!!item.subReviews && item.expand && item.children.length<item.subReviews}}" class="comment-reply" data-rid="{{item.id}}" data-subpagesize="{{item.subPageSize}}" catchtap="handleSubComment">展开更多回复</view>
          </view>
          <view class="like" catchtap="likeComment" data-currComment="{{item}}">
              <image src="/assets/icons/heart-fill.png" wx:if="{{item.likedByCurUser}}"/>
              <image src="/assets/icons/heart.png" wx:else/>
              {{item.like}}
          </view>
      </view>
      <view wx:if="{{stopLoading}}" class="end-comment">- THE END -</view>
  </view>
</scroll-view>
